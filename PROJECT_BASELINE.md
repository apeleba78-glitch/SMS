# 프로젝트 절대 기준선 (Development Constitution)

이 문서는 본 프로젝트의 절대 기준선이다.  
기준에 없는 기능은 추가하지 않는다.  
모든 개발 판단은 이 문서를 따른다.

---

## 1. UI / UX 기준

### 1-1. 모바일 우선 원칙 (Mobile First 2026)

- 기본 화면 기준 폭은 **360px ~ 430px**
- 데스크탑은 확장형 보조 화면이다
- 한 화면에는 **하나의 주요 목적**만 둔다
- 스크롤은 허용하지만 **과도한 모달은 사용하지 않는다**
- **탭은 3개를 초과하지 않는다**
- 주요 행동 버튼은 화면 하단 고정 가능하다

### 1-2. 디자인 시스템 기준

**디자인 철학**

- Flat 기반 UI
- 그림자 최소화
- radius는 **12px ~ 16px**
- 기본 패딩은 **16px**
- 카드 기반 구조
- 정보 과밀 배치 금지

### 1-3. 상태 색상 기준 (고정)

사용 가능한 색상은 아래 **5개만** 허용한다.

| 상태     | 색상        |
|----------|-------------|
| 기본     | Neutral Gray |
| 완료     | Green 600   |
| 진행중   | Blue 600    |
| 주의     | Orange 500  |
| 위험     | Red 600    |

**새 색상 추가 금지.**

### 1-4. 버튼 규격 통일

**Primary 버튼 기준**

- 높이 **48px**
- radius **14px**
- font-size **16px**
- font-weight **600**
- width **100%**

**버튼 문구 통일 (표현 변형 금지)**

- 확인
- 저장
- 완료 처리
- 취소
- 해결 완료

(예: "확인하기", "확인 완료" 등 사용 금지)

---

## 2. 이미지 업로드 기준

### 2-1. 파일 규격

- 포맷: **WebP**
- 긴쪽 **1280px 이하**
- 최대 용량 **300KB**
- 압축 품질 **75~80**
- EXIF 데이터 제거
- 원본 저장 금지

### 2-2. 저장 구조

```
issues/{issue_id}/before.webp
issues/{issue_id}/after.webp
tasks/{task_id}/{log_id}.webp
```

DB에는 **파일 경로만** 저장한다.

---

## 3. 데이터 처리 기준

### 3-1. 실시간 계산 금지 원칙

**금지**

- 화면 로딩 시 통계 계산
- 실시간 count(*) 대량 호출
- 교회 전체 집계 즉시 계산

**허용**

- `room_status` 테이블 사전 유지
- `daily_task` 사전 생성
- 이벤트 기반 상태 업데이트

### 3-2. 로그와 상태 분리 원칙

- **logs** 테이블: 이력 저장 전용
- **status** 테이블: 현재 상태 전용
- **summary** 테이블: 집계 전용

**하나의 테이블에 혼합하지 않는다.**

---

## 4. API 기준

### 4-1. 한 화면 = 한 API 호출

공간 상세 화면은 아래 **RPC 하나만** 호출한다.

```
rpc_room_detail(room_id, date)
```

여러 API 병렬 호출 금지.

### 4-2. 반환 데이터 최소화

- 필요한 컬럼만 select
- **select \*** 금지
- 사진은 URL 또는 path만 반환
- 긴 텍스트는 상세화면에서만 반환

---

## 5. 성능 기준

**100명 이상 동시 사용**을 기준으로 설계한다.

**필수 규칙**

- 모든 FK 컬럼 인덱스 생성
- `room_status` 주요 컬럼 인덱스 생성
- 날짜 기반 인덱스 생성
- N+1 쿼리 금지
- select * 금지
- 불필요한 join 금지

---

## 6. 상태 업데이트 원칙

상태는 **직접 수정하지 않는다.**  
항상 **이벤트 기반** 갱신한다.

**예시**

- 이슈 생성 → `room_status.open_issue_count` +1
- 이슈 해결 → `room_status.open_issue_count` -1
- 청소 완료 → `room_status.clean_done_today` = true
- 점검 완료 → `room_status.check_done_ratio_today` 갱신

---

## 7. 권한 기준

권한은 **church_id 단위**로 분리한다.

| 역할              | 권한 범위           |
|-------------------|---------------------|
| admin             | 전체 관리           |
| facility_lead     | 이슈 처리 가능     |
| facility_sublead  | 이슈 확인 가능     |
| staff             | 접수 및 완료 처리 가능 |

모든 변경 기록에는 **수행자(member_id)** 를 자동 저장한다.

---

## 8. 코드 작성 기준

- 모든 시간은 **timestamptz** 사용
- timezone은 **church.timezone** 기준
- 상태값은 **enum 타입** 정의 후 사용
- **magic string** 사용 금지
- boolean 남발 금지 → **status enum** 사용

---

## 9. 공간 카드 필수 표시 요소

공간 카드에는 **반드시** 아래 4가지를 표시한다.

1. 청소 상태
2. 미해결 이슈 수
3. 점검 완료율
4. 부족 비품 수

**이 4개는 고정 요소이다.**

---

## 10. 기능 확장 기준

기능 추가 전 **반드시** 검증한다.

- 공간 중심 관리와 **직접 관련**이 있는가?
- 상태 테이블에 **반영 가능**한가?
- **성능에 영향**을 주지 않는가?

기준을 충족하지 못하면 **개발하지 않는다.**

---

## 11. 보완 기준

### 11-1. 문서 관리

- 문서 하단에 **버전·최종 수정일** 표기 (예: v1.0, 2026-02-11)
- 기준선 수정 시 **변경 제안 → 검토 → 합의** 절차를 거친 뒤 반영한다

### 11-2. 에러·예외 처리

- 사용자에게 보여줄 에러 메시지는 **짧고 일관된 톤**으로 통일한다
- 네트워크 실패 시: "다시 시도", "나중에 동기화" 등 **최소 동작만** 정의하여 일관되게 처리한다

### 11-3. API·DB 네이밍

- REST 경로를 쓸 경우 **동사/명사, 단수·복수** 규칙을 정한 뒤 준수한다
- DB·컬럼은 **snake_case** 유지, 약어는 허용 목록에 있는 것만 사용한다

### 11-4. 보안

- **church_id**는 토큰/세션에서만 취득한다. 요청 본문·쿼리로 덮어쓰지 않는다
- 이미지 URL 정책(서명 URL 사용 여부·만료)을 정한 뒤 준수한다

### 11-5. 접근성

- 주요 버튼·카드는 **포커스·스크린리더** 최소 대응을 유지한다

### 11-6. 캐시·동기화

- 한 화면 한 API 호출에 대해 **캐시 시간**(예: 1분)과 **무효화 시점**(이벤트 발생 시 등)을 정해 두고 적용한다

### 11-7. 날짜·시간 표시

- 화면 표시 형식은 **church.timezone** 기준으로 통일한다 (예: YYYY.MM.DD, "오늘/어제" 표현 여부)

### 11-8. 목록·페이지네이션

- 카드 목록은 **한 번에 로드할 개수**와 **방식**(더보기 vs 무한 스크롤) 중 하나로 통일한다

---

> 이 문서는 본 시스템의 개발 헌법이다.  
> 디자인, API, DB, 이미지, 성능은 이 기준을 벗어나지 않는다.  
> 모든 신규 기능은 이 문서와 충돌하지 않아야 한다.
